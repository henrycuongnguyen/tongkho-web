---
import MainLayout from '@layouts/main-layout.astro';
import HeroSection from '@components/home/hero-section.astro';
import FeaturedProjectSection from '@components/home/featured-project-section.astro';
import PropertiesSection from '@components/home/properties-section.astro';
import LocationsSection from '@components/home/locations-section.astro';
import NewsSection from '@components/home/news-section.astro';
import PartnersSection from '@components/home/partners-section.astro';
import DownloadAppSection from '@components/home/download-app-section.astro';
import PressCoverageSection from '@components/home/press-coverage-section.astro';
import { elasticsearchPropertyService } from '@/services/elasticsearch-property-service';
import { postgresNewsProjectService } from '@/services/postgres-news-project-service';

// Enable SSR for this page (fetch fresh data on each request)
export const prerender = false;

// Fetch all data in parallel for optimal performance
const [propertiesForSale, propertiesForRent, featuredProjects, latestNews] = await Promise.all([
  elasticsearchPropertyService.searchProperties('sale', 8),
  elasticsearchPropertyService.searchProperties('rent', 8),
  postgresNewsProjectService.getFeaturedProjects(5),
  postgresNewsProjectService.getLatestNews(8),
]);
---

<MainLayout
  title="Tổng Kho Bất Động Sản - Mua Bán, Cho Thuê, Dự Án Mới Nhất"
  description="TongkhoBDS.com - Tổng kho bất động sản lớn nhất Việt Nam. Mua bán, cho thuê nhà đất, căn hộ, biệt thự với hàng ngàn tin đăng cập nhật mỗi ngày."
>
  <HeroSection />
  <FeaturedProjectSection projects={featuredProjects} />
  <PropertiesSection
    title="Bất động sản đang bán"
    properties={propertiesForSale}
    viewAllLink="/mua-ban"
  />
  <PropertiesSection
    title="Bất động sản cho thuê"
    properties={propertiesForRent}
    viewAllLink="/cho-thue"
    variant="warm"
  />
  <LocationsSection />

  <!-- Partners & Download App combined section -->
  <div class="relative bg-secondary-800 pb-56 lg:pb-72">
    <PartnersSection />
  </div>
  <div class="relative -mt-56 lg:-mt-72 z-10">
    <DownloadAppSection />
  </div>

  <NewsSection articles={latestNews} />
  <PressCoverageSection />
</MainLayout>
